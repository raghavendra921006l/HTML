<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<title>SERPENT</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
:root{
  --bg:#07101f;
  --glass:rgba(255,255,255,0.06);
  --border:rgba(255,255,255,0.13);
  --green:#00ff88;
  --teal:#00e5ff;
  --red:#ff4d6d;
  --gold:#ffd700;
  --dim:rgba(255,255,255,0.45);
}
html,body{height:100%;width:100%;overflow:hidden;background:var(--bg);font-family:'Rajdhani',sans-serif;color:#fff;touch-action:none}
body::before{content:'';position:fixed;inset:0;
  background:radial-gradient(ellipse 70% 50% at 15% 15%,rgba(0,255,136,0.06) 0%,transparent 65%),
             radial-gradient(ellipse 60% 70% at 85% 85%,rgba(0,229,255,0.06) 0%,transparent 65%);
  pointer-events:none;z-index:0}

.app{position:relative;z-index:1;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:8px 12px;gap:7px;max-width:520px;margin:0 auto}

header{text-align:center;flex-shrink:0}
header h1{font-family:'Orbitron',monospace;font-size:clamp(1.3rem,5vw,1.9rem);font-weight:900;letter-spacing:.35em;background:linear-gradient(135deg,var(--green),var(--teal));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;filter:drop-shadow(0 0 14px rgba(0,255,136,.4))}
header p{font-size:.65rem;letter-spacing:.2em;color:var(--dim);text-transform:uppercase}

.stats{display:flex;gap:8px;width:100%;flex-shrink:0}
.stat{flex:1;background:var(--glass);border:1px solid var(--border);border-radius:12px;padding:7px 10px;text-align:center;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px)}
.stat-label{font-size:.58rem;letter-spacing:.18em;color:var(--dim);text-transform:uppercase}
.stat-val{font-family:'Orbitron',monospace;font-size:clamp(.9rem,3.5vw,1.3rem);font-weight:700;line-height:1.1}
.stat:nth-child(1) .stat-val{color:var(--green);text-shadow:0 0 14px rgba(0,255,136,.6)}
.stat:nth-child(2) .stat-val{color:var(--teal);text-shadow:0 0 14px rgba(0,229,255,.6)}
.stat:nth-child(3) .stat-val{color:#bf5fff;text-shadow:0 0 14px rgba(191,95,255,.6)}
@keyframes pop{0%{transform:scale(1)}40%{transform:scale(1.5)}100%{transform:scale(1)}}
.pop{animation:pop .26s ease}

.canvas-wrap{position:relative;flex-shrink:0;border-radius:16px;padding:2.5px;background:linear-gradient(135deg,rgba(0,255,136,.5),rgba(0,229,255,.3),rgba(191,95,255,.4));box-shadow:0 0 40px rgba(0,255,136,.1),0 8px 32px rgba(0,0,0,.5)}
.canvas-inner{background:#060e1a;border-radius:14px;overflow:hidden;position:relative}
canvas{display:block}

.overlay{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;background:rgba(6,14,26,.92);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-radius:14px;z-index:20;transition:opacity .35s,visibility .35s;padding:20px;text-align:center}
.overlay.hidden{opacity:0;visibility:hidden;pointer-events:none}
.ov-title{font-family:'Orbitron',monospace;font-size:clamp(1.1rem,5vw,1.7rem);font-weight:900;letter-spacing:.2em}
.ov-title.green{color:var(--green);text-shadow:0 0 24px rgba(0,255,136,.6)}
.ov-title.red{color:var(--red);text-shadow:0 0 24px rgba(255,77,109,.6)}
.ov-sub{font-size:.82rem;color:var(--dim);line-height:1.75;letter-spacing:.04em}
.ov-score{font-family:'Orbitron',monospace;font-size:.88rem;color:var(--dim);letter-spacing:.12em}
.ov-score span{color:var(--teal);font-size:1.25rem}
@keyframes flash{0%,100%{opacity:1}50%{opacity:.3}}
.new-rec{font-family:'Orbitron',monospace;font-size:.72rem;letter-spacing:.2em;color:var(--gold);text-shadow:0 0 16px rgba(255,215,0,.7);animation:flash .9s ease infinite}

.btn{font-family:'Orbitron',monospace;font-size:.72rem;font-weight:700;letter-spacing:.2em;padding:12px 34px;border:none;border-radius:50px;cursor:pointer;background:linear-gradient(135deg,var(--green),var(--teal));color:#060e1a;box-shadow:0 0 26px rgba(0,255,136,.4),0 4px 14px rgba(0,0,0,.4);transition:transform .18s,box-shadow .18s;position:relative;overflow:hidden}
.btn::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.22),transparent);pointer-events:none}
.btn:active{transform:scale(.94)}

.pause-pill{position:absolute;top:9px;right:9px;background:rgba(255,77,109,.15);border:1px solid rgba(255,77,109,.35);border-radius:20px;padding:3px 11px;font-family:'Orbitron',monospace;font-size:.58rem;letter-spacing:.15em;color:var(--red);z-index:5;opacity:0;transition:opacity .2s}
.pause-pill.on{opacity:1}

/* â”€â”€ D-PAD â”€â”€ */
.dpad-wrap{flex-shrink:0;display:flex;flex-direction:column;align-items:center;gap:0;width:100%}
.dpad{position:relative;width:144px;height:144px;flex-shrink:0}
.dpad-btn{position:absolute;display:flex;align-items:center;justify-content:center;background:var(--glass);border:1px solid var(--border);border-radius:12px;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);cursor:pointer;transition:background .1s,transform .1s;user-select:none;-webkit-user-select:none}
.dpad-btn:active,.dpad-btn.pressed{background:rgba(0,255,136,.2);border-color:rgba(0,255,136,.55);transform:scale(.92)}
.dpad-btn svg{width:20px;height:20px;fill:rgba(255,255,255,.75)}
.dpad-up   {top:0;left:49px;width:46px;height:46px}
.dpad-down {bottom:0;left:49px;width:46px;height:46px}
.dpad-left {top:49px;left:0;width:46px;height:46px}
.dpad-right{top:49px;right:0;width:46px;height:46px}
.dpad-center{position:absolute;top:49px;left:49px;width:46px;height:46px;border-radius:50%;background:var(--glass);border:1px solid var(--border);display:flex;align-items:center;justify-content:center}
.dpad-center span{width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green)}
.pause-btn{font-family:'Orbitron',monospace;font-size:.58rem;letter-spacing:.15em;padding:7px 18px;background:var(--glass);border:1px solid var(--border);border-radius:20px;color:rgba(255,255,255,.65);cursor:pointer;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);margin-top:7px}
.pause-btn:active{background:rgba(255,77,109,.18)}

/* â”€â”€ SCORES â”€â”€ */
.scores-wrap{width:100%;background:var(--glass);border:1px solid var(--border);border-radius:12px;padding:9px 15px;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);flex-shrink:0;overflow:hidden}
.scores-title{font-family:'Orbitron',monospace;font-size:.58rem;letter-spacing:.25em;color:var(--dim);text-transform:uppercase;margin-bottom:7px}
.score-row{display:flex;justify-content:space-between;align-items:center;padding:3px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:.8rem}
.score-row:last-child{border-bottom:none}
.s-rank{font-family:'Orbitron',monospace;font-size:.62rem;color:var(--dim);width:20px}
.s-rank.g{color:#ffd700}.s-rank.s{color:#c0c0c0}.s-rank.b{color:#cd7f32}
.s-val{font-family:'Orbitron',monospace;font-size:.9rem;color:var(--green)}
.s-date{font-size:.68rem;color:var(--dim)}
.no-scores{color:var(--dim);font-size:.78rem;text-align:center;padding:3px 0}
</style>
</head>
<body>
<div class="app">

  <header>
    <h1>SERPENT</h1>
    <p>Glass Snake</p>
  </header>

  <div class="stats">
    <div class="stat"><div class="stat-label">Score</div><div class="stat-val" id="scoreEl">0</div></div>
    <div class="stat"><div class="stat-label">Best</div><div class="stat-val" id="bestEl">0</div></div>
    <div class="stat"><div class="stat-label">Length</div><div class="stat-val" id="lenEl">1</div></div>
  </div>

  <div class="canvas-wrap" id="canvasWrap">
    <div class="canvas-inner" id="canvasInner">
      <canvas id="c"></canvas>
      <div class="pause-pill" id="pausePill">PAUSED</div>

      <div class="overlay" id="startOv">
        <div class="ov-title green">SERPENT</div>
        <div class="ov-sub">Guide the snake Â· Eat the orbs<br>Don't hit the walls or yourself</div>
        <button class="btn" id="startBtn">START GAME</button>
        <div class="ov-sub" style="font-size:.68rem;margin-top:2px">âŒ¨ Arrow Keys / WASD &nbsp;Â·&nbsp; P = Pause<br>ğŸ“± D-Pad or swipe on screen</div>
      </div>

      <div class="overlay hidden" id="gameOverOv">
        <div class="ov-title red">GAME OVER</div>
        <div class="ov-score">Score: <span id="finalScore">0</span></div>
        <div class="new-rec hidden" id="newRec">âœ¦ NEW RECORD âœ¦</div>
        <button class="btn" id="restartBtn">PLAY AGAIN</button>
      </div>
    </div>
  </div>

  <div class="dpad-wrap">
    <div class="dpad">
      <div class="dpad-btn dpad-up"    id="dUp">   <svg viewBox="0 0 24 24"><path d="M12 5l8 10H4z"/></svg></div>
      <div class="dpad-btn dpad-left"  id="dLeft"> <svg viewBox="0 0 24 24"><path d="M5 12l10-8v16z"/></svg></div>
      <div class="dpad-center"><span></span></div>
      <div class="dpad-btn dpad-right" id="dRight"><svg viewBox="0 0 24 24"><path d="M19 12L9 4v16z"/></svg></div>
      <div class="dpad-btn dpad-down"  id="dDown"> <svg viewBox="0 0 24 24"><path d="M12 19l8-10H4z"/></svg></div>
    </div>
    <button class="pause-btn" id="pauseBtn">â¸ PAUSE</button>
  </div>

  <div class="scores-wrap">
    <div class="scores-title">â¬¡ High Scores</div>
    <div id="scoresList"></div>
  </div>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const COLS = 20, ROWS = 16;
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let CELL = 22;

function sizeCanvas() {
  const maxW = Math.min(window.innerWidth - 28, 516);
  CELL = Math.max(14, Math.floor(maxW / COLS));
  canvas.width  = CELL * COLS;
  canvas.height = CELL * ROWS;
  document.getElementById('canvasWrap').style.width = (canvas.width + 5) + 'px';
}
sizeCanvas();
window.addEventListener('resize', () => { sizeCanvas(); if (!running) drawFrame(); });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let snake, dir, nextDir, food, score, speed, ticker, animId;
let running = false, paused = false, isOver = false;
let particles = [];
let foodT = 0;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HIGH SCORES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getScores() { try { return JSON.parse(localStorage.getItem('srp3_hi') || '[]'); } catch { return []; } }
function saveScore(s) {
  if (!s) return false;
  let a = getScores();
  const isNew = !a.length || s > a[0].score;
  a.push({ score: s, date: new Date().toLocaleDateString() });
  a.sort((x,y) => y.score - x.score);
  localStorage.setItem('srp3_hi', JSON.stringify(a.slice(0,8)));
  renderScores(); return isNew;
}
function renderScores() {
  const a = getScores();
  document.getElementById('bestEl').textContent = a.length ? a[0].score : 0;
  const el = document.getElementById('scoresList');
  if (!a.length) { el.innerHTML = '<div class="no-scores">No scores yet â€” play!</div>'; return; }
  const rc=['g','s','b'], rs=['â‘ ','â‘¡','â‘¢'];
  el.innerHTML = a.map((s,i)=>
    `<div class="score-row"><span class="s-rank ${rc[i]||''}">${rs[i]||(i+1)}</span><span class="s-val">${s.score}</span><span class="s-date">${s.date}</span></div>`
  ).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initGame() {
  const sx = Math.floor(COLS/2), sy = Math.floor(ROWS/2);
  snake = [{x:sx,y:sy},{x:sx-1,y:sy},{x:sx-2,y:sy}];
  dir = {x:1,y:0}; nextDir = {x:1,y:0};
  score = 0; speed = 1; particles = []; foodT = 0;
  placeFood(); updateHUD();
}
function placeFood() {
  let p;
  do { p = {x:Math.floor(Math.random()*COLS), y:Math.floor(Math.random()*ROWS)}; }
  while (snake.some(s => s.x===p.x && s.y===p.y));
  food = p;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PARTICLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function burst(gx, gy) {
  for (let i=0;i<16;i++) {
    const a=(Math.PI*2/16)*i+Math.random()*.35, sp=1.8+Math.random()*3.2;
    particles.push({x:gx*CELL+CELL/2,y:gy*CELL+CELL/2,
      vx:Math.cos(a)*sp, vy:Math.sin(a)*sp,
      life:1, decay:.032+Math.random()*.04,
      size:2.5+Math.random()*3.5,
      hue: 120+Math.random()*40});
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UPDATE (game logic tick)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function update() {
  dir = {...nextDir};
  const h = {x: snake[0].x+dir.x, y: snake[0].y+dir.y};
  if (h.x<0||h.x>=COLS||h.y<0||h.y>=ROWS||snake.some(s=>s.x===h.x&&s.y===h.y)) { endGame(); return; }
  snake.unshift(h);
  if (h.x===food.x && h.y===food.y) {
    score += 10*speed;
    burst(food.x, food.y);
    popAnim(document.getElementById('scoreEl'));
    placeFood();
    const ns = Math.min(5,1+Math.floor(score/60));
    if (ns!==speed) { speed=ns; clearInterval(ticker); ticker=setInterval(update,getMs()); }
  } else { snake.pop(); }
  updateHUD();
}
function getMs() { return [195,160,132,108,88][speed-1]||195; }
function updateHUD() {
  document.getElementById('scoreEl').textContent = score;
  document.getElementById('lenEl').textContent   = snake.length;
}
function popAnim(el) { el.classList.remove('pop'); void el.offsetWidth; el.classList.add('pop'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DRAW â€” all rendering
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawFrame() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawGrid();
  drawParticles();
  drawFood();
  drawSnake();
}

function drawGrid() {
  ctx.strokeStyle = 'rgba(255,255,255,0.018)';
  ctx.lineWidth = 0.5;
  for (let x=0;x<=COLS;x++) { ctx.beginPath();ctx.moveTo(x*CELL,0);ctx.lineTo(x*CELL,canvas.height);ctx.stroke(); }
  for (let y=0;y<=ROWS;y++) { ctx.beginPath();ctx.moveTo(0,y*CELL);ctx.lineTo(canvas.width,y*CELL);ctx.stroke(); }
}

function drawParticles() {
  particles = particles.filter(p=>p.life>0);
  particles.forEach(p => {
    ctx.save();
    ctx.globalAlpha = p.life*p.life;
    const c = `hsl(${p.hue},100%,${55+p.life*20}%)`;
    ctx.fillStyle = c; ctx.shadowColor = c; ctx.shadowBlur = 10;
    ctx.beginPath(); ctx.arc(p.x,p.y,p.size*p.life,0,Math.PI*2); ctx.fill();
    ctx.restore();
    p.x+=p.vx; p.y+=p.vy; p.vx*=0.92; p.vy*=0.92; p.life-=p.decay;
  });
}

function drawFood() {
  foodT = (foodT+0.08)%(Math.PI*2);
  const fx = food.x*CELL+CELL/2, fy = food.y*CELL+CELL/2;
  const r  = CELL*0.28 + Math.sin(foodT)*CELL*0.04;

  // Soft outer glow
  const glow = ctx.createRadialGradient(fx,fy,0,fx,fy,r*4.5);
  glow.addColorStop(0,'rgba(0,255,136,.22)');
  glow.addColorStop(1,'rgba(0,255,136,0)');
  ctx.fillStyle=glow; ctx.beginPath(); ctx.arc(fx,fy,r*4.5,0,Math.PI*2); ctx.fill();

  // Orb
  ctx.save();
  ctx.shadowColor='#00ff88'; ctx.shadowBlur=20;
  const og = ctx.createRadialGradient(fx-r*.3,fy-r*.35,0,fx,fy,r);
  og.addColorStop(0,'#ffffff');
  og.addColorStop(.2,'#aaffdd');
  og.addColorStop(.6,'#00ee77');
  og.addColorStop(1,'#005533');
  ctx.fillStyle=og; ctx.beginPath(); ctx.arc(fx,fy,r,0,Math.PI*2); ctx.fill();
  ctx.restore();
}

// â”€â”€ SNAKE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawSnake() {
  if (!snake.length) return;
  const n   = snake.length;
  // Center pixel coords
  const px = i => snake[i].x*CELL + CELL/2;
  const py = i => snake[i].y*CELL + CELL/2;

  // Build smooth midpoint path
  const pts = [];
  pts.push({x:px(0), y:py(0)});
  for (let i=0; i<n-1; i++) pts.push({x:(px(i)+px(i+1))/2, y:(py(i)+py(i+1))/2});
  pts.push({x:px(n-1), y:py(n-1)});
  const np = pts.length;

  const BASE_R = CELL * 0.40;

  // â”€â”€ 1. Cast shadow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ctx.save();
  ctx.lineCap='round'; ctx.lineJoin='round';
  ctx.shadowColor='rgba(0,0,0,.65)';
  ctx.shadowBlur=10; ctx.shadowOffsetX=2.5; ctx.shadowOffsetY=4;
  ctx.strokeStyle='rgba(0,0,0,.25)';
  ctx.lineWidth = BASE_R*2+2;
  _strokePath(pts, np);
  ctx.restore();

  // â”€â”€ 2. Main body â€” layer by layer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Draw each spinal point as an oriented ellipse for clean 3D tube look
  for (let i=np-1; i>=1; i--) {
    const t = i/(np-1);
    const p = pts[i], pp = pts[i-1];
    const r = BASE_R * (1 - t*0.22); // taper to tail
    const angle = Math.atan2(pp.y-p.y, pp.x-p.x);

    ctx.save();
    ctx.translate(p.x, p.y);
    ctx.rotate(angle);

    // 3D cylinder gradient: dark top/bottom, bright equator
    const cg = ctx.createLinearGradient(0,-r,0,r);
    cg.addColorStop(0,    'hsl(140,72%,14%)');   // dark dorsal
    cg.addColorStop(0.12, 'hsl(138,68%,22%)');
    cg.addColorStop(0.40, 'hsl(136,70%,42%)');   // bright midband
    cg.addColorStop(0.60, 'hsl(135,65%,35%)');
    cg.addColorStop(0.85, 'hsl(138,65%,18%)');
    cg.addColorStop(1,    'hsl(140,70%,10%)');   // dark ventral
    ctx.fillStyle = cg;
    ctx.beginPath();
    ctx.ellipse(0,0, r*1.06, r, 0, 0, Math.PI*2);
    ctx.fill();

    // Scale texture: alternating darker ovals along the spine
    const si = Math.floor(i*0.7)%2;
    ctx.fillStyle = si ? 'rgba(0,0,0,.15)' : 'rgba(255,255,255,.055)';
    ctx.beginPath();
    ctx.ellipse(0, si ? -r*.26 : r*.26, r*.58, r*.36, 0, 0, Math.PI*2);
    ctx.fill();

    // Specular highlight â€” wet skin gloss
    const sg = ctx.createRadialGradient(-r*.15,-r*.5,0, 0,-r*.25, r*.8);
    sg.addColorStop(0, `rgba(255,255,255,${.35-t*.18})`);
    sg.addColorStop(.55,`rgba(255,255,255,${.05-t*.04})`);
    sg.addColorStop(1,  'rgba(255,255,255,0)');
    ctx.fillStyle=sg;
    ctx.beginPath();
    ctx.ellipse(0,0,r*1.06,r,0,0,Math.PI*2);
    ctx.fill();

    ctx.restore();
  }

  // â”€â”€ 3. Head â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  _drawHead(pts, BASE_R);
}

function _strokePath(pts, np) {
  ctx.beginPath();
  ctx.moveTo(pts[0].x, pts[0].y);
  for (let i=1;i<np;i++) ctx.lineTo(pts[i].x, pts[i].y);
  ctx.stroke();
}

function _drawHead(pts, baseR) {
  const h  = pts[0];
  const nx = pts[Math.min(2,pts.length-1)];
  const angle = Math.atan2(h.y-nx.y, h.x-nx.x);
  const hw = baseR*1.42, hh = baseR*1.06;

  ctx.save();
  ctx.translate(h.x, h.y);
  ctx.rotate(angle);

  // Shadow
  ctx.save();
  ctx.shadowColor='rgba(0,0,0,.55)'; ctx.shadowBlur=12;
  ctx.shadowOffsetX=2.5; ctx.shadowOffsetY=4;
  ctx.fillStyle='rgba(0,0,0,.1)';
  ctx.beginPath(); ctx.ellipse(hw*.1,0,hw,hh,0,0,Math.PI*2); ctx.fill();
  ctx.restore();

  // Base head gradient â€” 3D cylinder like body
  const hg = ctx.createLinearGradient(0,-hh,0,hh);
  hg.addColorStop(0,   'hsl(140,72%,14%)');
  hg.addColorStop(.12, 'hsl(138,68%,24%)');
  hg.addColorStop(.42, 'hsl(136,72%,46%)');
  hg.addColorStop(.65, 'hsl(135,67%,36%)');
  hg.addColorStop(.88, 'hsl(138,65%,20%)');
  hg.addColorStop(1,   'hsl(140,70%,10%)');
  ctx.fillStyle=hg;
  ctx.beginPath(); ctx.ellipse(hw*.1,0,hw,hh,0,0,Math.PI*2); ctx.fill();

  // Head scale patch
  ctx.fillStyle='rgba(0,0,0,.18)';
  ctx.beginPath(); ctx.ellipse(hw*.25,-hh*.32,hw*.38,hh*.24,0,0,Math.PI*2); ctx.fill();
  ctx.fillStyle='rgba(255,255,255,.06)';
  ctx.beginPath(); ctx.ellipse(hw*.25,hh*.3,hw*.38,hh*.24,0,0,Math.PI*2); ctx.fill();

  // Specular
  const hs = ctx.createRadialGradient(-hw*.2,-hh*.52,0, 0,-hh*.2, hw*.95);
  hs.addColorStop(0,'rgba(255,255,255,.4)');
  hs.addColorStop(.45,'rgba(255,255,255,.08)');
  hs.addColorStop(1,'rgba(255,255,255,0)');
  ctx.fillStyle=hs;
  ctx.beginPath(); ctx.ellipse(hw*.1,0,hw,hh,0,0,Math.PI*2); ctx.fill();

  // Nostrils
  [-1,1].forEach(s => {
    ctx.fillStyle='rgba(0,0,0,.72)';
    ctx.beginPath(); ctx.ellipse(hw*.82,s*hh*.36,baseR*.1,baseR*.08,.3,0,Math.PI*2); ctx.fill();
  });

  // â”€â”€ Eyes â”€â”€
  [-1,1].forEach(side => {
    const ex=hw*.22, ey=side*hh*.58;

    // Socket
    ctx.fillStyle='rgba(0,0,0,.55)';
    ctx.beginPath(); ctx.ellipse(ex,ey,baseR*.36,baseR*.3,0,0,Math.PI*2); ctx.fill();

    // Iris â€” amber gold
    const ig=ctx.createRadialGradient(ex,ey,0,ex,ey,baseR*.28);
    ig.addColorStop(0,'#f5c400');
    ig.addColorStop(.5,'#b08500');
    ig.addColorStop(1,'#3a2400');
    ctx.fillStyle=ig;
    ctx.beginPath(); ctx.ellipse(ex,ey,baseR*.28,baseR*.25,0,0,Math.PI*2); ctx.fill();

    // Vertical slit pupil â€” key reptile feature
    ctx.fillStyle='#080808';
    ctx.beginPath(); ctx.ellipse(ex,ey,baseR*.063,baseR*.2,0,0,Math.PI*2); ctx.fill();

    // Bright glint
    ctx.fillStyle='rgba(255,255,255,.78)';
    ctx.beginPath(); ctx.ellipse(ex-baseR*.09,ey-baseR*.1,baseR*.072,baseR*.056,-.5,0,Math.PI*2); ctx.fill();

    // Eyelid ring
    ctx.strokeStyle='rgba(0,0,0,.3)'; ctx.lineWidth=.7;
    ctx.beginPath(); ctx.ellipse(ex,ey,baseR*.32,baseR*.28,0,0,Math.PI*2); ctx.stroke();
  });

  // â”€â”€ Forked tongue (animated) â”€â”€
  const phase = (Date.now()/175)%(Math.PI*2);
  const tout  = .5+Math.sin(phase)*.5;
  if (tout>.1) {
    const tl=baseR*1.3*tout, fl=baseR*.55*tout, fa=.43;
    ctx.strokeStyle='#cc0033'; ctx.lineWidth=1.7; ctx.lineCap='round';
    ctx.shadowColor='#ff1144'; ctx.shadowBlur=7;
    ctx.beginPath(); ctx.moveTo(hw*.92,0); ctx.lineTo(hw*.92+tl,0); ctx.stroke();
    const fb=hw*.92+tl;
    ctx.beginPath(); ctx.moveTo(fb,0); ctx.lineTo(fb+Math.cos(fa)*fl,Math.sin(fa)*fl);  ctx.stroke();
    ctx.beginPath(); ctx.moveTo(fb,0); ctx.lineTo(fb+Math.cos(-fa)*fl,Math.sin(-fa)*fl); ctx.stroke();
  }

  ctx.restore();
}

// â”€â”€ RAF loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loop() { animId=requestAnimationFrame(loop); drawFrame(); }
function stopLoop() { if (animId) { cancelAnimationFrame(animId); animId=null; } }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GAME CONTROL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startGame() {
  document.getElementById('startOv').classList.add('hidden');
  document.getElementById('gameOverOv').classList.add('hidden');
  initGame(); running=true; paused=false; isOver=false;
  clearInterval(ticker); ticker=setInterval(update,getMs());
  stopLoop(); loop();
}
function endGame() {
  running=false; isOver=true; clearInterval(ticker);
  const isNew=saveScore(score);
  document.getElementById('finalScore').textContent=score;
  document.getElementById('newRec').classList.toggle('hidden',!isNew);
  document.getElementById('gameOverOv').classList.remove('hidden');
}
function togglePause() {
  if (!running||isOver) return;
  paused=!paused;
  document.getElementById('pausePill').classList.toggle('on',paused);
  document.getElementById('pauseBtn').textContent=paused?'â–¶ RESUME':'â¸ PAUSE';
  if (paused) { clearInterval(ticker); stopLoop(); drawFrame(); }
  else        { ticker=setInterval(update,getMs()); loop(); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INPUT â€” keyboard
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const KM = {
  ArrowUp:{x:0,y:-1},w:{x:0,y:-1},W:{x:0,y:-1},
  ArrowDown:{x:0,y:1},s:{x:0,y:1},S:{x:0,y:1},
  ArrowLeft:{x:-1,y:0},a:{x:-1,y:0},A:{x:-1,y:0},
  ArrowRight:{x:1,y:0},d:{x:1,y:0},D:{x:1,y:0},
};
document.addEventListener('keydown',e=>{
  if (e.key===' '){e.preventDefault();if(!running||isOver)startGame();return;}
  if (e.key==='p'||e.key==='P'){togglePause();return;}
  if (paused||!running)return;
  const m=KM[e.key];
  if(m){e.preventDefault();if(!(m.x===-dir.x&&m.y===-dir.y))nextDir=m;}
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INPUT â€” D-Pad
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function bindDpad(id,dx,dy){
  const el=document.getElementById(id);
  const go=e=>{
    e.preventDefault();
    el.classList.add('pressed');
    if(!running||isOver){startGame();return;}
    if(paused)return;
    const m={x:dx,y:dy};
    if(!(m.x===-dir.x&&m.y===-dir.y))nextDir=m;
  };
  el.addEventListener('touchstart',go,{passive:false});
  el.addEventListener('mousedown',go);
  el.addEventListener('touchend',()=>el.classList.remove('pressed'),{passive:true});
  el.addEventListener('mouseup',()=>el.classList.remove('pressed'));
}
bindDpad('dUp',   0,-1);
bindDpad('dDown', 0, 1);
bindDpad('dLeft',-1, 0);
bindDpad('dRight',1, 0);

document.getElementById('pauseBtn').addEventListener('click',()=>{
  if(!running&&!isOver)startGame(); else togglePause();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INPUT â€” Swipe on canvas
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let ts=null;
const ci=document.getElementById('canvasInner');
ci.addEventListener('touchstart',e=>{ts={x:e.touches[0].clientX,y:e.touches[0].clientY};},{passive:true});
ci.addEventListener('touchend',e=>{
  if(!ts)return;
  const dx=e.changedTouches[0].clientX-ts.x, dy=e.changedTouches[0].clientY-ts.y;
  ts=null;
  if(Math.abs(dx)<12&&Math.abs(dy)<12)return;
  if(!running||isOver||paused)return;
  let m;
  if(Math.abs(dx)>Math.abs(dy)) m=dx>0?{x:1,y:0}:{x:-1,y:0};
  else                           m=dy>0?{x:0,y:1}:{x:0,y:-1};
  if(!(m.x===-dir.x&&m.y===-dir.y))nextDir=m;
},{passive:true});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('startBtn').addEventListener('click',startGame);
document.getElementById('restartBtn').addEventListener('click',startGame);
renderScores();
initGame();
loop(); // idle preview animation
</script>
</body>
</html>